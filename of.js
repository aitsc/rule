var obj = JSON.parse($response.body);

var email = obj.userinfo.email;
var id = obj.userinfo.omni_id;
var receipt = "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";

obj.registrations = [{
    "registration_date": "2019-12-31T08:50:34.098006+00:00",
    "user_id": [id.slice(0,8),id.slice(8,12),id.slice(12,16),id.slice(16,20),id.slice(20)].join("-"),
    "bundle_id": "com.omnigroup.OmniFocus3.iOS",
    "purchased_product_ids": ["ITOF3_SUB_ANNUAL"],
    "receipt_data": btoa(atob(receipt).replace("@@@@@@",email).replace("&&&&&&",id)),
    "description": "OmniFocus Subscription Annual",
    "transaction_id": "330000565002995",
    "product": "OmniFocus 3 Pro iOS"
  }];

obj.subscriptions = [{
    "vending_product_id": "OMNIFOCUS_ALL",
    "description": "OmniFocus Subscription Annual",
    "product_id": "ITOF3_SUB_ANNUAL",
    "subscription_state": "active",
    "auto_renew_status": true,
    "expires_date": "2099-01-14T08:50:30+00:00"
  }];

$done({body: JSON.stringify(obj)});
